<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>MVP Online Judge</title>
  <style>
    body { margin:0; font-family:system-ui, sans-serif; }
    .wrap { display:flex; height:100vh; }
    textarea { width:50%; height:100%; padding:12px; font-family:ui-monospace, monospace; font-size:14px; }
    .right { width:50%; padding:12px; overflow:auto; border-left:1px solid #ddd; }
    .row { margin-bottom:8px; }
    button { padding:8px 12px; }
    pre { background:#f7f7f7; padding:8px; }
  </style>
</head>
<body>
<div class="wrap">
  <textarea id="code">// C++20 sample
#include <bits/stdc++.h>
using namespace std;
int main(){
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    long long a,b; if(!(cin>>a>>b)) return 0;
    cout << (a+b) << "\n";
    return 0;
}
  </textarea>
  <div class="right">
    <div class="row">
      <label>Language:</label>
      <select id="lang">
        <option value="cpp">C++ (C++20)</option>
        <option value="c">C (C17)</option>
      </select>
      <label>Opt:</label>
      <select id="opt">
        <option>O2</option><option>O1</option><option>O0</option>
      </select>
      <label>Problem:</label>
      <input id="pid" value="sum-two" />
      <button id="btn">Compile & Run</button>
    </div>
    <div class="row"><b>Status:</b> <span id="status">idle</span></div>
    <div class="row"><b>Compile log:</b><pre id="clog"></pre></div>
    <div class="row"><b>Run result:</b><pre id="rlog"></pre></div>
  </div>
</div>
<script>
const api = "http://localhost:8000";
const btn = document.getElementById("btn");
const statusEl = document.getElementById("status");
const clog = document.getElementById("clog");
const rlog = document.getElementById("rlog");

btn.onclick = async () => {
  statusEl.textContent = "submitting...";
  clog.textContent = ""; rlog.textContent = "";
  const body = {
    language: document.getElementById("lang").value,
    code: document.getElementById("code").value,
    problem_id: document.getElementById("pid").value,
    opt: document.getElementById("opt").value
  };
  const res = await fetch(api + "/v1/submit", {method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify(body)});
  const js = await res.json();
  const id = js.submission_id;
  statusEl.textContent = "queued ("+id+")";

  // poll
  let tries=0;
  while (tries<120) {
    await new Promise(r=>setTimeout(r,1000));
    const sres = await fetch(api + "/v1/submission/" + id);
    if (!sres.ok) break;
    const data = await sres.json();
    statusEl.textContent = data.meta.status;
    if (data.compile_log) clog.textContent = data.compile_log;
    if (data.run_result) rlog.textContent = JSON.stringify(data.run_result, null, 2);
    if (["done","failed","compile_error","error","run_timeout","compile_timeout","problem_not_found"].includes(data.meta.status)) break;
    tries++;
  }
};
</script>
</body>
</html>
